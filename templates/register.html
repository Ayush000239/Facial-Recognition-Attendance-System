
{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-md-6">
    <div class="card p-4">
      <h4 class="mb-3">Create Account</h4>
      <form method="post" action="{{ url_for('auth.register') }}">
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input class="form-control" name="name" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Student ID</label>
          <input class="form-control" name="student_id" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Role</label>
          <select name="role" class="form-select">
            <option value="student">Student</option>
            <option value="instructor">Instructor</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" name="password" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Reference Face (capture)</label>
          <div class="ratio ratio-4x3 bg-body-secondary rounded mb-2">
            <video id="video" autoplay playsinline></video>
          </div>
          <div class="d-flex gap-2 mb-2">
            <button type="button" class="btn btn-outline-primary" onclick="capture()">Capture</button>
            <button type="button" class="btn btn-outline-secondary" onclick="flipCamera()">Flip</button>
          </div>
          <img id="preview" class="img-fluid rounded d-none" alt="preview">
          <input type="hidden" id="face_image" name="face_image">
        </div>
        <button class="btn btn-primary">Register</button>
      </form>
    </div>
  </div>
</div>
<script>
let video = document.getElementById('video');
let streamRef = null;
let useFacing = 'user';
function startCamera(){
  navigator.mediaDevices.getUserMedia({ video: { facingMode: useFacing } })
  .then(stream => { streamRef = stream; video.srcObject = stream; })
  .catch(err => { console.error(err); alert('Camera access error'); });
}
function flipCamera(){
  useFacing = (useFacing === 'user') ? 'environment' : 'user';
  if(streamRef){ streamRef.getTracks().forEach(t=>t.stop()); }
  startCamera();
}
function capture(){
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth; canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);
  const data = canvas.toDataURL('image/png');
  document.getElementById('face_image').value = data;
  const img = document.getElementById('preview');
  img.src = data; img.classList.remove('d-none');
}
startCamera();
</script>
{% endblock %}
